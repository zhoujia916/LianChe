
<title>Puzzle Admin</title>

<div class="page-header">
    <h4>
        <i class="glyphicon glyphicon-signal"></i>
        文章管理
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            新建文章
        </small>

        <a class="btn btn-xs orange pull-right btn-warning" href="#page/autoarticle/index">
            <i class="glyphicon glyphicon-arrow-left"></i>返回文章管理</span></a>
    </h4>
</div>

<div class="row" id="">
    <div class="col-xs-12">
        <form class="form-horizontal">
            <div class="tabbable">
                <ul class="nav nav-tabs padding-16">
                    <li class="active">
                        <a data-toggle="tab" href="#edit-basic">
                            <i class="green ace-icon fa fa-pencil-square-o bigger-125"></i>
                            基本信息
                        </a>
                    </li>

                    <li>
                        <a data-toggle="tab" href="#edit-content">
                            <i class="purple ace-icon ace-icon fa fa-globe bigger-125"></i>
                            文章内容
                        </a>
                    </li>
                </ul>

                <div class="tab-content profile-edit-tab-content">
                    <div id="edit-basic" class="tab-pane in active">
                        <div class="space-10"></div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                文章标题
                            </label>
                            <div class="col-sm-9">
                                <input type="text" id="title" name="title" placeholder="标题" class="txt input-sm col-sm-8 ">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                文章副标题
                            </label>
                            <div class="col-sm-9">
                                <input type="text" id="title2" name="title2" placeholder="副标题" class="txt input-sm col-sm-8 ">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                封面图
                            </label>
                            <div class="col-sm-3" style="height:62px;">
                                <input type="file" id="cover" name="cover" placeholder="封面图片">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                所属分类
                            </label>
                            <div class="col-sm-9">
                                <select id="catId" name="catId" data-init="0">
                                    <option value="0">请选择分类</option>
                                    {{foreach from=$catList item=catItem}}
                                    <option value="{{$catItem.catId}}">{{$catItem.catName}}</option>
                                    {{/foreach}}
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                文章来源地址
                            </label>

                            <div class="col-sm-9">
                                <input type="text"  id="sourceUrl"  name="sourceUrl" placeholder="来源地址" class="txt input-sm col-sm-6">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                排序号
                            </label>

                            <div class="col-sm-9">
                                <input type="text" data-init="0" id="sortOrder"  name="sortOrder" placeholder="排序号" class="txt input-sm col-sm-2">
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>

                    <div id="edit-content" class="tab-pane">
                        <div class="space-10"></div>
                        <textarea id="content" name="content" style="min-height:300px;width:100%;"></textarea>
                    </div>
            </div>

            <div class="clearfix form-actions">
                <button id="btnReset" class="btn" type="reset">
                    <i class="ace-icon fa fa-undo bigger-110"></i>
                    重置
                </button>
                &nbsp; &nbsp;
                <button id="btnSubmit" class="btn btn-info" type="button">
                    <i class="ace-icon fa fa-check bigger-110"></i>
                    确定
                </button>
            </div>
        </form>


    </div><!-- /.col -->
</div><!-- /.row -->
<script type="text/javascript">
    $('.page-content-area').ace_ajax('loadScripts', [ null,
        "{{$contextPath}}/ueditor/ueditor.config.js",
        "{{$contextPath}}/ueditor/ueditor.all.min.js",
        "{{$contextPath}}/ueditor/lang/zh-cn/zh-cn.js",
        null], function() {

        var ueContent = UE.getEditor("content");

        $("#btnSubmit").on("click", function(){



            var pic = $("#hidPic").val();

            if(pic == ""){
                showConfirm("您确定不上传车源图片?", save);
            }
            save();

            function save(){
                console.log($("form").serialize());

                $.post("{{$contextPath}}/admin/autoarticle/action.do", "action=CREATE&" + $("form").serialize(), function(result){
                    if(result.code == 0){
                        changeHash("admin/autocar/index");
                    }else{
                        showTip(result.msg);
                    }
                }, "json");
            }
        });

        var date = new Date();
        var month = date.getMonth();
        var day = date.getDate();

        var date1 = date.getFullYear() + "-" + (month < 9 ? ("0" + (1 + month)) : (1 + month)) + "-" + day;

        $( "#datepicker1").val(date1);

        $( "#datepicker1" ).datepicker({
            showOtherMonths: true,
            selectOtherMonths: false
        });

        $('#cover').ace_file_input({
            style:'well',
            allowExt: ["jpeg", "jpg", "png", "gif" , "bmp"],
            allowMime: ["image/jpg", "image/jpeg", "image/png", "image/gif", "image/bmp"],

            btn_choose:'拖放或点击选择图片',
            btn_change:null,
            no_icon:'ace-icon fa fa-cloud-upload',
            droppable:true,
            thumbnail:'small',
            //,icon_remove:null//set null, to hide remove/reset button
            /**,before_change:function(files, dropped) {
						//Check an example below
						//or examples/file-upload.html
						return true;
					}*/
            before_remove : function() {
                $("#hidCover").val("");
                return true;
            },
            preview_error : function(filename, error_code) {
                var errorMsg = '';
                if(error_code == 2){
                    errorMsg = "加载读取图片出错";
                }else if(error_code == 3){
                    errorMsg = "创建缩列图出错";
                }
                showTip(errorMsg);
                //name of the file that failed
                //error_code values
                //1 = 'FILE_LOAD_FAILED',
                //2 = 'IMAGE_LOAD_FAILED',
                //3 = 'THUMBNAIL_FAILED'
                //alert(error_code);
            }
        });
    });
</script>
